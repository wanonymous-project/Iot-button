//GETリクエスト時に呼び出される関数
function doGet(e) {

  //▼SHEET情報の設定--------------------------------------------------------------

  //IoT_button_A
  const SPREAD_SHEET_ID_IoT_button_A = '1DbkOzjZgfafqamjoArpap_l5ALO4J_v0o9CbwVKtaXQ';
  const SHEET_NAME_Iot_button_A = 'query';

  //部屋状態フラグ
  const SPREAD_SHEET_ID_room_status_flg = '1SupSrnjGNuus-ASH5jTMu1ptKz79X3XoiM1j6WZwhro';

  //BME280
  const SPREAD_SHEET_ID_bme280 = '1iNjsxJWTYh2Qkz6HrGS9MaM-OSAxHXc23KgraNFNrDw'
  const SHEET_NAME_bme280 = 'query';

  //▲SHEET情報の設定--------------------------------------------------------------

  //餌やり・水交換クラス
  class FeedData{

    constructor() {
      this.latest_food_time = '1990/01/01 00:00:00';
      this.latest_water_time = '1990/01/01 00:00:00'; 
    }

    getFeedData(){

      //スプレットシート情報の取得
      const sheet = SpreadsheetApp.openById(SPREAD_SHEET_ID_IoT_button_A).getSheetByName(SHEET_NAME_Iot_button_A);
      
      //データ取得
      this.latest_food_time = sheet.getRange('B4').getValue();
      this.latest_water_time = sheet.getRange('B8').getValue();
    
    }

  }

  //部屋利用情報クラス
  class Room_status_flg{

    constructor(){
      this.washitsu_status_flg = 0; 
      this.living_status_flg = 0;
    }

    getRoomStatusFlg(){

      //スプレットシート情報の取得
      const sheet = SpreadsheetApp.openById(SPREAD_SHEET_ID_room_status_flg).getActiveSheet();
      
      //データ取得
      this.washitsu_status_flg = sheet.getRange('B2').getValue();
      this.living_status_flg = sheet.getRange('B3').getValue();

    }

  }

  //温湿度情報
  class Room_environment{

    constructor(){
      this.bme280_temperature = 0;
      this.bme280_humidity = 0; 
      this.nature_remo_temperature = 0;
      this.nature_remo_humidity = 0;
    }

    getRoomEnvironmentData(){

      //スプレットシート情報の取得
      const sheet_bme280 = SpreadsheetApp.openById(SPREAD_SHEET_ID_bme280).getSheetByName(SHEET_NAME_bme280);
      
      //データ取得
      this.bme280_temperature = sheet_bme280.getRange('B8').getValue();
      this.bme280_humidity = sheet_bme280.getRange('B12').getValue();

    }

  }

  //＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋＋

  var feed_data = new FeedData();  //餌やり情報のインスタンス化
  feed_data.getFeedData(); //餌やりデータをspread sheetから取得

  var room_status_flg = new Room_status_flg(); //部屋情報のインスタンス化
  room_status_flg.getRoomStatusFlg(); //部屋情報データをspread sheetから取得


  sendData(a,b,c) //データの送信

  return result;
}



function sendData(a,b,c){

  //返却情報を生成
  const result = ContentService.createTextOutput();

  //Mime TypeをJSONに設定
  result.setMimeType(ContentService.MimeType.JSON);

  //JSONテキストをセットする
  result.setContent(JSON.stringify(data));
  
}




